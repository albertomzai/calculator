{
  "files": [
    {
      "filename": "docs/backend_documentation.md",
      "action": "create_or_update",
      "code": [
        "# Visión General del Proyecto",
        "",
        "El proyecto es una **calculadora web** sencilla que permite al usuario introducir expresiones aritméticas a través de una interfaz gráfica y recibir el resultado calculado por un servicio backend. La lógica de la UI está implementada en HTML, CSS y JavaScript puro, mientras que el cálculo real se delega a una API REST que expone el endpoint `/api/calculate`.",
        "",
        "El flujo típico es:",
        "",
        "1. El usuario pulsa botones numéricos y operadores; el script mantiene la expresión actual en la variable `expression`.",
        "2. Al pulsar **=**, se envía una petición POST con el cuerpo `{ expression: \"...\" }` al endpoint `/api/calculate`.",
        "3. La API devuelve un JSON con la propiedad `result`, que se muestra en la pantalla.",
        "",
        "# Arquitectura del Sistema",
        "",
        "La arquitectura sigue un patrón **cliente‑servidor** simple:",
        "",
        "- **Front‑end**: HTML/CSS/JS que renderiza la calculadora y gestiona eventos de usuario.",
        "- **Back‑end**: Un microservicio Node.js (o cualquier lenguaje) expone una API REST con un solo endpoint para evaluar expresiones.",
        "",
        "La comunicación se realiza sobre HTTP/1.1, usando JSON como formato de intercambio. No hay autenticación ni persistencia; todo es en memoria y stateless.",
        "",
        "## Diagrama de Componentes",
        "",
        "```mermaid",
        "graph TD;",
        "  UI[Front‑end] -->|POST /api/calculate| API[Back‑end]",
        "  API -->|JSON response| UI",
        "```",
        "",
        "# Endpoints de la API",
        "",
        "| Método | Ruta            | Descripción                                 | Cuerpo de Solicitud               | Respuesta (ejemplo)                     | Código de Estado |",
        "|--------|-----------------|---------------------------------------------|-----------------------------------|------------------------------------------|------------------|",
        "| POST   | `/api/calculate` | Evalúa una expresión aritmética.           | `{ \"expression\": \"2+3*4\" }`    | `{ \"result\": 14 }`                     | `200 OK`         |",
        "",
        "### Validaciones y Errores",
        "",
        "- **Cuerpo inválido**: Si el JSON no contiene la clave `expression` o su valor no es una cadena, se devuelve `400 Bad Request` con `{ \"message\": \"Invalid payload\" }`.",
        "- **Expresión sintácticamente incorrecta**: Se devuelve `422 Unprocessable Entity` con `{ \"message\": \"Malformed expression\" }`.",
        "",
        "### Ejemplo de Implementación (Node.js/Express)",
        "",
        "```js",
        "const express = require('express');",
        "const app = express();",
        "app.use(express.json());",
        "",
        "function safeEval(expr) {",
        "  // Implementar un parser seguro o usar una librería como mathjs",
        "}",
        "",
        "app.post('/api/calculate', (req, res) => {",
        "  const { expression } = req.body;",
        "  if (!expression || typeof expression !== 'string') {",
        "    return res.status(400).json({ message: 'Invalid payload' });",
        "  }",
        "",
        "  try {",
        "    const result = safeEval(expression);",
        "    res.json({ result });",
        "  } catch (e) {",
        "    res.status(422).json({ message: e.message || 'Malformed expression' });",
        "  }",
        "});",
        "",
        "app.listen(3000, () => console.log('API running on port 3000'));",
        "```",
        "",
        "# Instrucciones de Instalación y Ejecución",
        "",
        "1. **Clonar el repositorio**:",
        "",
        "   ```bash",
        "   git clone <repo-url>",
        "   cd <repo-dir>",
        "   ```",
        "",
        "2. **Instalar dependencias del backend (Node.js)**:",
        "",
        "   ```bash",
        "   npm install express body-parser mathjs",
        "   ```",
        "",
        "3. **Ejecutar el servidor**:",
        "",
        "   ```bash",
        "   node server.js",
        "   ```",
        "",
        "4. **Abrir la calculadora en el navegador**:",
        "",
        "   Navega a `http://localhost:3000/index.html` (o abre directamente el archivo `index.html`).",
        "",
        "# Flujo de Datos Clave",
        "",
        "```mermaid",
        "sequenceDiagram",
        "  participant U as Usuario",
        "  participant F as Front‑end",
        "  participant B as Back‑end",
        "",
        "  U->>F: Pulsa botones → actualiza `expression`",
        "  alt Pulsar =",
        "    U->>F: Envía POST /api/calculate { expression }",
        "    F->>B: HTTP/1.1 POST /api/calculate",
        "    B-->>F: 200 OK { result }",
        "    F->>U: Muestra resultado en pantalla",
        "  end",
        "```",
        "",
        "# Extensiones Futuras (Opcional)",
        "",
        "- **Persistencia**: Guardar historial de cálculos en una base de datos y exponer un endpoint `/api/history`.",
        "- **Autenticación**: Añadir JWT para usuarios registrados que puedan acceder a su propio historial.",
        "- **Soporte de funciones matemáticas avanzadas** (sen, cos, log) mediante una librería como `mathjs`.",
        "- **Interfaz móvil responsive** con Bootstrap o Tailwind CSS.",
        "- **Pruebas unitarias**: Jest para el backend y Cypress para la UI."
      ]
    }
  ]
}